import { useEffect, useMemo } from "react";

export default function PortfolioCreator({ portfolio, setHtml }) {

  const html = useMemo(() => {
    if (!portfolio) return "";

    return `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>${portfolio.name || "Portfolio"}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<base target="_blank">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #6366f1;
  --secondary: #22d3ee;
  --dark: #020617;
  --light: #f8fafc;
  --glass: rgba(255,255,255,0.08);
  --border: rgba(255,255,255,0.18);
  --heading-dark: #f1f5f9;
  --sub-dark: #c7d2fe;
}

/* RESET */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Poppins", sans-serif;
}

body {
  background: radial-gradient(circle at top, #020617, #000);
  color: var(--light);
  overflow-x: hidden;
}

/* NAVBAR */
nav {
  position: fixed;
  top: 0;
  width: 100%;
  backdrop-filter: blur(14px);
  background: rgba(2,6,23,0.9);
  border-bottom: 1px solid var(--border);
  z-index: 1000;
}

nav ul {
  display: flex;
  justify-content: center;
  gap: 32px;
  padding: 16px;
  list-style: none;
}

nav a {
  color: var(--light);
  text-decoration: none;
  font-weight: 500;
  position: relative;
  cursor: pointer;
}

nav a::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  transition: 0.3s;

}

nav a:hover::after {
  width: 100%;
  
}

/* HERO */
.hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 140px 10%;
}

.hero-inner {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 70px;
  align-items: center;
  animation: fadeUp 1s ease forwards;
}

.hero h1 {
  font-size: 3.3rem;
  font-weight: 700;
  background: linear-gradient(90deg, #ffffff, var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.hero p {
  margin-top: 12px;
  font-size: 1.1rem;
  opacity: 0.85;
}

/* PROFILE IMAGE */
.profile-pic {
  width: 300px;
  height: 300px;
  border-radius: 20px;
  padding: 5px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  animation: float 4s ease-in-out infinite;
}

.profile-pic img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 16px;
}

/* SCROLL REVEAL */
.reveal {
  opacity: 0;
  transform: translateY(40px);
  transition: all 0.9s ease;
}

.reveal.active {
  opacity: 1;
  transform: translateY(0);
}

/* SECTIONS */
section {
  padding: 90px 10%;
}

/* HEADINGS */
section h2 {
  text-align: center;
  margin-bottom: 45px;
  font-size: 2.4rem;
  font-weight: 700;
  color: var(--heading-dark);
}

/* CARD */
.card {
  background: var(--glass);
  backdrop-filter: blur(14px);
  border: 1px solid var(--border);
  border-radius: 22px;
  padding: 32px;
}

/* RESUME BUTTONS */
.resume-actions {
  margin-top: 22px;
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
}

.resume-actions a {
  padding: 10px 18px;
  border-radius: 30px;
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  color: #020617;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  transition: transform 0.2s ease, opacity 0.2s ease;
}

.resume-actions a:hover {
  transform: translateY(-2px);
  opacity: 0.9;
}

/* SKILLS */
.chips span {
  display: inline-block;
  margin: 8px;
  padding: 10px 18px;
  border-radius: 30px;
  background: rgba(255,255,255,0.14);
  font-size: 14px;
}

/* PROJECTS */
.project-card {
  margin-bottom: 26px;
}

.project-card h3 {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--sub-dark);
}

/* EXPERIENCE */
.timeline {
  border-left: 4px solid var(--primary);
  padding-left: 40px;
}

.timeline-item {
  margin-bottom: 22px;
  position: relative;
}

.timeline-item::before {
  content: "";
  position: absolute;
  left: -14px;
  top: 6px;
  width: 14px;
  height: 14px;
  background: var(--secondary);
  border-radius: 50%;
}

.timeline-item p {
  line-height: 1.7;
  color: #e5e7eb;
}

/* CONTACT */
.contact p {
  margin-bottom: 14px;
  font-weight: 500;
  color: var(--sub-dark);
}

/* FOOTER */
footer {
  text-align: center;
  padding: 35px;
  border-top: 1px solid var(--border);
  opacity: 0.6;
}

/* ANIMATIONS */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

/* MOBILE */
@media (max-width: 480px) {
  .hero {
    padding: 120px 6% 80px;
  }
  .hero-inner {
    grid-template-columns: 1fr;
    text-align: center;
    gap: 30px;
  }
  .hero h1 {
    font-size: 2.2rem;
  }
  .profile-pic {
    width: 220px;
    height: 220px;
    margin: 0 auto;
  }
  section {
    padding: 70px 6%;
  }
  nav ul {
    gap: 18px;
    flex-wrap: wrap;
  }
}
</style>
</head>

<body>

<nav>
  <ul>
    ${portfolio.about ? `<li><a data-scroll="about">About</a></li>` : ""}
    ${portfolio.skills?.length ? `<li><a data-scroll="skills">Skills</a></li>` : ""}
    ${portfolio.projects?.length ? `<li><a data-scroll="projects">Projects</a></li>` : ""}
    ${portfolio.experience?.length ? `<li><a data-scroll="experience">Experience</a></li>` : ""}
    ${(portfolio.github || portfolio.linkedin || portfolio.instagram || portfolio.email || portfolio.phone)
      ? `<li><a data-scroll="contact">Contact</a></li>` : ""}
  </ul>
</nav>


<div class="hero">
  <div class="hero-inner">
    <div>
      <h1>${portfolio.name || ""}</h1>
      <p>${portfolio.title || ""}</p>
    </div>

    ${portfolio.imageUrl ? `
    <div class="profile-pic">
      <img src="${portfolio.imageUrl}" alt="Profile" />
    </div>` : ""}
  </div>
</div>

${portfolio.about ? `
<section id="about" class="reveal">
  <h2>About</h2>
  <div class="card">
    <p>${portfolio.about}</p>

    ${portfolio.resumeUrl ? `
    <div class="resume-actions">
      <a
        href="${portfolio.resumeUrl.replace('/image/upload/', '/raw/upload/')}"
        target="_blank"
        rel="noopener noreferrer"
      >
        View Resume
      </a>

    </div>` : ""}
  </div>
</section>` : ""}

${portfolio.skills?.length ? `
<section id="skills" class="reveal">
  <h2>Skills</h2>
  <div class="card chips">
    ${portfolio.skills.map(s => `<span>${s.value}</span>`).join("")}
  </div>
</section>` : ""}

${portfolio.projects?.length ? `
<section id="projects" class="reveal">
  <h2>Projects</h2>
  <div class="card">
    ${portfolio.projects.map(p => `
      <div class="project-card">
        <h3>${p.title}</h3>
        <p>${p.description}</p>
      </div>
    `).join("")}
  </div>
</section>` : ""}

${portfolio.experience?.length ? `
<section id="experience" class="reveal">
  <h2>Experience</h2>
  <div class="card">
    <div class="timeline">
      ${portfolio.experience.map(e => `
        <div class="timeline-item">
          <p>${e.value}</p>
        </div>
      `).join("")}
    </div>
  </div>
</section>` : ""}

${(portfolio.github || portfolio.linkedin || portfolio.instagram || portfolio.email || portfolio.phone) ? `
<section id="contact" class="reveal">
  <h2>Contact</h2>
  <div class="card contact">
    ${portfolio.github ? `<p><b style="color:yellow;">GitHub:</b> ${portfolio.github}</p>` : ""}
    ${portfolio.linkedin ? `<p><b style="color:yellow;">LinkedIn:</b> ${portfolio.linkedin}</p>` : ""}
    ${portfolio.instagram ? `<p><b style="color:yellow;">Instagram:</b> ${portfolio.instagram}</p>` : ""}
    ${portfolio.email ? `<p><b style="color:yellow;">Email:</b> ${portfolio.email}</p>` : ""}
    ${portfolio.phone ? `<p><b style="color:yellow;">Phone:</b> ${portfolio.phone}</p>` : ""}
  </div>
</section>` : ""}

<footer>
  © ${new Date().getFullYear()} ${portfolio.name || ""}
</footer>

<script>
  /* Reveal animation */
  const reveals = document.querySelectorAll(".reveal");
  const revealOnScroll = () => {
    const h = window.innerHeight;
    reveals.forEach(el => {
      if (el.getBoundingClientRect().top < h - 120) {
        el.classList.add("active");
      }
    });
  };
  window.addEventListener("scroll", revealOnScroll);
  revealOnScroll();

  /* ✅ SAFE NAV SCROLL (NO RELOAD, NO NEW TAB) */
  document.querySelectorAll("[data-scroll]").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      const id = link.getAttribute("data-scroll");
      const section = document.getElementById(id);
      if (section) {
        section.scrollIntoView({ behavior: "smooth" });
      }
    });
  });
</script>


</body>
</html>
`;
  }, [portfolio]);

  useEffect(() => {
    if (typeof setHtml === "function") {
      setHtml(html);
    }
  }, [html, setHtml]);

  return null;
}
